<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR Editor</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
</head>

<body>
    <div class="ide-container">
        <!-- Top Header -->
        <header class="ide-header">
            <div class="left-controls">
                <button class="btn-sm" onclick="window.history.back()">
                    BACK
                </button>
                <div class="pr-info">
                    <span id="prRepoInfo" style="color: var(--text-dim); font-size: 0.85rem;"></span>
                    <span id="prTitle"
                        style="font-weight: bold; color: var(--primary-color); margin-left: 0.5rem;">LOADING...</span>
                </div>
            </div>
            <div class="right-controls">
                <button class="btn-sm" id="commitPushBtn" onclick="commitAndPush()">
                    <span id="commitBtnText">COMMIT & PUSH</span>
                    <span id="commitSpinner" class="hidden">...</span>
                </button>
            </div>
        </header>

        <div class="ide-workspace">
            <!-- Activity Bar -->
            <aside class="activity-bar">
                <div class="activity-icon active" id="tab-icon-files" title="Explorer" onclick="switchIDEView('files')">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path
                            d="M14.5 3H7.71l-.85-.85L6.51 2h-5l-.5.5v11l.5.5h13l.5-.5v-10L14.5 3zm-.51 8.49V13h-12V7h4.49l.35-.15.86-.86H14v1.5z" />
                    </svg>
                </div>
                <div class="activity-icon" id="tab-icon-report" title="Analysis Report"
                    onclick="switchIDEView('report')">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path
                            d="M1.5 1h13l.5.5v13l-.5.5h-13l-.5-.5v-13l.5-.5zM2 2v12h12V2H2zm2 7h3v4H4V9zm4-4h3v8H8V5zm4 2h3v6h-3V7z" />
                    </svg>
                </div>
            </aside>

            <!-- File Explorer Sidebar -->
            <aside class="ide-sidebar" id="ideSidebar">
                <div class="ide-sidebar-header">
                    <span>EXPLORER</span>
                </div>
                <div id="fileListContainer" class="ide-file-list">
                    <!-- Files injected here -->
                    <div style="padding: 1rem; color: var(--text-dim); text-align: center;">LOADING FILES...</div>
                </div>
            </aside>

            <!-- Main Editor Area -->
            <main class="ide-main" id="view-files">
                <!-- Editor Tabs -->
                <div class="editor-tabs">
                    <div class="editor-tab active">
                        <span id="editorFileName">SELECT FILE</span>
                    </div>
                    <div style="margin-left: auto; display: flex; align-items: center; padding-right: 0.5rem;">
                        <button class="btn-sm" onclick="autoFixFile()"
                            style="font-size: 0.7rem; padding: 2px 6px;">AUTO-FIX</button>
                    </div>
                </div>

                <!-- Monaco Editor -->
                <div id="monacoEditor"></div>
            </main>

            <!-- Report View (Hidden by default) -->
            <main class="ide-main ide-report-view" id="view-report">
                <div class="report-header">
                    <h3>MULTI-AGENT ANALYSIS REPORT</h3>
                    <button class="btn-sm" id="showAnalysisBtn" onclick="displayCachedAnalysis()">
                        RUN ANALYSIS
                    </button>
                </div>

                <div id="reportContent" class="report-content">
                    <div style="color: var(--text-dim); text-align: center; padding: 2rem;">
                        CLICK "RUN ANALYSIS" TO VIEW RESULTS...
                    </div>
                </div>

                <div class="report-sections">
                    <div class="report-section">
                        <h4>SECURITY ANALYSIS</h4>
                        <div id="securityResults" class="report-section-content">
                            <p style="color: var(--text-dim);">No security analysis available.</p>
                        </div>
                    </div>

                    <div class="report-section">
                        <h4>PERFORMANCE</h4>
                        <div id="performanceResults" class="report-section-content">
                            <p style="color: var(--text-dim);">No performance analysis available.</p>
                        </div>
                    </div>
                    <div class="report-section">
                        <h4>CODE QUALITY</h4>
                        <div id="codeQualityResults" class="report-section-content">
                            <p style="color: var(--text-dim);">No analysis results available.</p>
                        </div>
                    </div>

                    <div class="report-section">
                        <h4>LINTER RESULTS</h4>
                        <div id="linterResults" class="report-section-content">
                            <p style="color: var(--text-dim);">No linter results available.</p>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Slide-out Chat Panel -->
            <aside class="ide-chat-panel" id="chatPanel">
                <div class="panel-header">
                    <span>AI ASSISTANT</span>
                    <button class="btn-icon" onclick="toggleChatPanel()" title="Close">X</button>
                </div>
                <div class="chat-container">
                    <div id="chatMessages" class="chat-messages">
                        <div style="color: var(--text-dim); text-align: center; margin-top: 2rem;">
                            AI Code Assistant Ready.<br>
                            Select a file to start analysis.
                        </div>
                    </div>
                    <div class="chat-input-area" style="padding: 1rem; border-top: 1px solid var(--primary-color);">
                        <input type="text" id="chatInput" placeholder="Ask about this code..."
                            onkeypress="handleChatInput(event)">
                        <button class="btn" onclick="sendChatMessage()">SEND</button>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Floating Chat Button -->
        <button class="floating-chat-btn" id="floatingChatBtn" onclick="toggleChatPanel()" title="Toggle AI Chat">
            <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                <path
                    d="M2.5 2h11l.5.5v8l-.5.5H8l-2.5 3v-3h-3l-.5-.5v-8l.5-.5zM3 3v7h3.5l.5.5v1.5l1.5-2 .5-.5h5V3H3z" />
            </svg>
        </button>
    </div>

    <!-- Terminal Loader -->
    <div class="terminal-loader" id="terminalLoader">
        <div class="terminal-window">
            <div class="terminal-header">
                <div class="terminal-dots">
                    <div class="terminal-dot"></div>
                    <div class="terminal-dot"></div>
                    <div class="terminal-dot"></div>
                </div>
                <div class="terminal-title">AI Multi-Agent Analysis</div>
            </div>
            <div class="terminal-body" id="terminalBody">
                <!-- Terminal output will be injected here -->
            </div>
        </div>
    </div>

    <!-- Commit Modal -->
    <div id="commitModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 style="margin: 0; color: var(--primary-color);">COMMIT MESSAGE</h3>
                <button class="btn-icon" onclick="closeCommitModal()" style="font-size: 1.5rem;">X</button>
            </div>
            <div class="modal-body">
                <input type="text" id="commitMessageInput" placeholder="Enter commit message..."
                    style="width: 100%; padding: 0.75rem; background: var(--surface-color); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; color: var(--text-color); font-size: 0.95rem;"
                    onkeypress="handleCommitInputKeypress(event)">
            </div>
            <div class="modal-footer" style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                <button class="btn-sm" onclick="closeCommitModal()">CANCEL</button>
                <button class="btn" onclick="confirmCommit()">COMMIT & PUSH</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            window.monaco = monaco;
            if (window.createMonacoEditor) {
                window.createMonacoEditor();
            }
        });
    </script>
</body>

</html>